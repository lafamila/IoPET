<!DOCTYPE HTML>
<html>

    <head>
        <meta charset="utf-8">
        <link href="{{url_for('static', filename='main.css') }}" rel="stylesheet">
    </head>

    <body>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="{{url_for('static', filename='transform.js') }}"></script>
        <script>
            var eventMethod = window.addEventListener ? "addEventListener" : "attachEvent";
            var eventer = window[eventMethod];
            var messageEvent = eventMethod == "attachEvent" ? "onmessage" : "message";
            console.log(eventMethod);
            console.log(messageEvent);
            // Listen to message from child window

            $body = $("body");

            var view = "#diag";
            var before = "#diag";
            $(document).on('click', '.check', function(){
                $( ".act" ).removeClass('act');
                view = "#more";
                $.each($(".nav-menu"), function(){
                    if($(this).data("item") == "more")
                        $(this).addClass('act');
                });
                $(".vs-wrapper").hide();
                $(view).show();
            });
            $(document).on('click', '.backDiag', function(){
                $( ".act" ).removeClass('act');
                view = "#diag";
                $.each($(".nav-menu"), function(){
                    if($(this).data("item") == "diag")
                        $(this).addClass('act');
                });
                $(".vs-wrapper").hide();
                $(view).show();
            });
            $(document).on('click','.nav-menu',function(){
                before = $( ".act" ).attr('data-item');
                $( ".act" ).removeClass('act');

                $(this).addClass('act');
                view = "#" + $(this).attr('data-item');
                if(view != "#chat"){
                    $(".vs-wrapper").hide();
                    $(view).show();
                }
                else{
                    var chatWindow = window.open("/chat?pet={{pet_id}}", "popupWindow", "width=1000,height=630,scrollbars=no");

/*
                    if (typeof chatWindow.attachEvent != "undefined") {
                        chatWindow.attachEvent("onunload", doStuffOnUnload);
                    } else if (typeof chatWindow.addEventListener != "undefined") {
                        chatWindow.addEventListener("unload", doStuffOnUnload, false);
                    }*/
                    //새창띄우기, 꺼지면 다시 before act 시키기기
               }
            });
            $(document).ready(function() {
                eventer(messageEvent,function(e) {
                  console.log('parent received message!:  ',e.data);
                },false);


                $(".vs-wrapper").hide();
                $(view).show();

                $body.addClass("loading");
                $.ajax({
                    url : '/load_personal',
                    success : function(data){
//                        console.log(JSON.stringify(data));
                        for(key in transform(data)){
//                            console.log('#'+key.toLowerCase());
//                            console.log(data[key]);
                            $('#'+key.toLowerCase()).html(data[key]);
                        }
                        $.ajax({
                           url : '/load_diagnosis',
                            success : function(data){
                                diagnosises = data;
                                for(var i=0;i<data.length;i++){
                                    var html = "<div class='cell content-prev' data-item='"+i+"'>"+data[i].DIAGN_DATE.split(" ")[0]+"</div>";
                                    $('#cell-prev').append(html);

                                }
                            },
                            complete : function(){
                                $body.removeClass("loading");
                            },
                            type : 'post',
                            dataType: 'json',
                            data : {pet_id : "{{pet_id}}", hospt_id : "{{hospt_id}}"}
                        });

                    },
                    fail : function(){
                        alert("asdfasdfasdf");
                    },
                    type : 'post',
                    dataType: 'json',
                    data : {pet_id : "{{pet_id}}"}
                });


                $("#diag_search").on('keyup', function(e) {

                    let word = $(this).val();

                    if (e.keyCode == 13){


                        if($(".search-type").attr("data-item") == 0){
                            if( $('.searched-list').length > 0){
                                let result = $('.searched-list').first().html();
                                let iid = $('.searched-list').first().attr('data-item');
                                let recommend = $('.searched-list').first().attr('data-recommend');
                                //중복검사
                                appendDisease(result, iid, recommend);
                                $(this).val("");
                                $('.search-list').empty();

                            }
                        }
                        else if($(".search-type").attr("data-item") == 1){
                            $("#searched2").append("<div class='searched-result-list-item2' data-select='0'>"+word+"</span>");
                            $(this).val("");
                            searchDisease();
                        }
                        else{
                            if( $('.searched-list').length > 0){
                                let result = $('.searched-list').first().html();
                                let iid = $('.searched-list').first().attr('data-item');
                                appendMedicine(result, iid);
                                $(this).val("");
                                $('.search-list').empty();

                            }
                        }

                    }
                    else{
                        if($(".search-type").attr("data-item") == 0){
                            if(word.length > 0){
                                $.ajax({
                                   url : '/search_disease',
                                    success : function(data){
                                        $('.search-list').empty();
                                        for(var i=0;i<data.length;i++){
                                            var $div = $("<div/>").addClass('searched-list')
                                                                   .html(data[i].DISEASE_NAME)
                                                                   .attr('data-item', data[i].DISEASE_ID)
                                                                   .attr('data-recommend', data[i].DISEASE_RECOMMEND);
                                            $('.search-list').append($div);
                                        }
                                    },
                                    type : 'post',
                                    dataType: 'json',
                                    data : {search : word}
                                });
                            }
                            else{
                                $('.search-list').empty();
                            }

                        }
                        else if($(".search-type").attr("data-item") == 1){
                            if(word.length > 0){
                                $.ajax({
                                   url : '/search_symptom',
                                    success : function(data){
                                        $('.search-list').empty();
                                        for(var i=0;i<data.length;i++){
                                            var html = "<div class='searched-list'>"+data[i]+"</div>";
                                            $('.search-list').append(html);
                                        }
                                    },
                                    type : 'post',
                                    dataType: 'json',
                                    data : {search : word}
                                });
                            }
                            else{
                                $('.search-list').empty();
                            }

                        }


                        else if($(".search-type").attr("data-item") == 2){
                            if(word.length > 0){
                                $.ajax({
                                   url : '/search_medicine',
                                    success : function(data){
                                        $('.search-list').empty();
                                        for(var i=0;i<data.length;i++){
                                            var html = "<div class='searched-list' data-item='"+data[i].MEDI_ID+"'>"+data[i].MEDI_NAME+"</div>";

                                            $('.search-list').append(html);
                                        }
                                    },
                                    type : 'post',
                                    dataType: 'json',
                                    data : {search : word}
                                });
                            }
                            else{
                                $('.search-list').empty();
                            }

                        }

                    }
                });



                $(".chat").click(function(){
                    window.open('/chat?pet={{pet_id}}', "popupWindow", "width=600,height=600,scrollbars=no,resizable=no");
                });
            });
            $(document).on('click','.content-prev',function(){
                $( ".content-prev" ).removeClass('selected');
                $(this).addClass('selected');
                $('#cell-prev-c').html(diagnosises[$(this).attr("data-item")].DIAGN_OPINION.replace(/\n/g,"<br/>"));
            });
            $(document).on('click','.search-button',function(){
                $(".search-button").removeClass('search-type');
                $(this).addClass('search-type');
            });
            $(document).on('click','.searched-list',function(){

                var result = $(this).html();
                if($(".search-type").attr("data-item") != 1){
                    let iid = $(this).attr('data-item');
                    let recommend = $(this).attr('data-recommend');
                    //중복검사
                    if($(".search-type").attr("data-item") == 0){
                        appendDisease(result, iid, recommend);
                    }
                    else if($(".search-type").attr("data-item") == 2){
                        appendMedicine(result, iid);
                    }
                    $('#diag_search').val("");
                    $('.search-list').empty();
                }
                else{
                    /*
                    lafamila
                    */
                    $("#searched2").append("<div class='searched-result-list-item2' data-select='0'>"+result+"</span>");
                    searchDisease();

                    $('#diag_search').val("");
                    $('.search-list').empty();

                }
            });
            $(document).on('mouseover','.searched-list',function(){
                var currentColor = $(this).css('background-color');
                $('.searched-list').css('background-color', 'rgba(255, 255, 255, 0.9)');
                $(this).css('background-color', 'rgba(92, 116, 183, 0.9)');

                //var lastComma = currentColor.lastIndexOf(')');
                //var newColor = currentColor.slice(0, lastComma - 1) + ", "+ o + ")";-->
                //$(e).css('background-color', newColor);
            });
            $(document).on('mouseout','.search-list',function(){
                $('.searched-list').css('background-color', 'rgba(255, 255, 255, 0.9)');
            });
            $(document).on('click','.medicine-categorys', function(){
                if($(this).hasClass("tagSelected")){
                    $(this).removeClass('tagSelected');
                    $('#medicine').empty();
                }
                else{
                    $('#medicine').empty();

                    $('.medicine-categorys.tagSelected').removeClass('tagSelected');
                    $(this).addClass('tagSelected');

                    $('#medicine').append($('<strong/>').html($(this).html()))
                                  .append($('<br/>'))
                                  .append($(this).data('intro'))
                                  .append($('<br/>'))
                                  .append($('<br/>'))
                                  .append($('<strong/>').html("용법 : "));
                    if($(this).data('method') == 0){
                        $('#medicine').append("PO(경구투여)");
                    }
                    $('#medicine').append($('<br/>'))
                                  .append($('<br/>'))
                                  .append($('<strong/>').html("부작용"))
                                  .append($('<br/>'))
                                  .append($(this).data('side'))
                                  .append($('<br/>'))
                                  .append($('<br/>'))
                                  .append($('<strong/>').html("주의사항"))
                                  .append($('<br/>'))
                                  .append($(this).data('warn'))
                                  .append($('<br/>'))
                                  .append($('<br/>'));
                }
            });
            $(document).on('click','.searched-result-list-item1',function(){
                if($(this).attr("data-select") == 1){
                    $(this).attr("data-select", 0);
                    $(this).removeClass('tagSelected');
                    $("#medicine-category").empty();
                    $("#medicine").empty();
                }
                else{
                    $(".searched-result-list-item1.tagSelected").attr("data-select", 0);
                    $(".searched-result-list-item1.tagSelected").removeClass('tagSelected');
                    $(this).attr("data-select", 1);
                    $(this).addClass('tagSelected');
                }
                searchMedicine();
            });
            $(document).on('dblclick','.medicine-categorys',function(){
                alert($(this).data('id'));
                var $div = $('<div/>');
                var idArr1 = [];
                var list1 = $(".medi-name-cell");
                let idx = list1.length;
                $.each(list1, function () {

                    idArr1.push($(this).html());
                 });
                 if(!idArr1.includes($(this).html())){
                $div.addClass("cell-long");
                           $div.append($('<div/>').addClass("cell").addClass("medi-name-cell").attr('data-idx', idx+1).html($(this).html()))
                           .append($('<div/>').addClass("cell").attr('data-idx', idx+1).html($(this).data('vol')+'mg/kg'))
                           .append($('<div/>').addClass("cell").attr('data-idx', idx+1).html($(this).data('period')))
                           .append($('<div/>').addClass("cell").attr('data-idx', idx+1).html($(this).data('doses')))
                           .append($('<div/>').addClass("cell").attr('data-idx', idx+1).html($(this).data('vol') * $('#pet_weight').html().split('kg')[0] * $(this).data('doses') + 'mg'))
                           .append($('<div/>').addClass("cell").attr('data-idx', idx+1).html($(this).data('vol') * $('#pet_weight').html().split('kg')[0] * $(this).data('doses') * $(this).data('period') + 'mg'))
                           .append($('<div/>').addClass("cell").attr('data-idx', idx+1).html(2))
                           .append($('<div/>').addClass("cell").attr('data-idx', idx+1).html(CommaFormatted($(this).data('price'))))
                           .append($('<div/>').addClass("cell").addClass("medi-price-cell").attr('data-idx', idx+1).html(CommaFormatted($(this).data('price') * 2)));
                $('.cell-container').append($div);
                if($(".searched-result-list-item1.tagSelected").length > 0){
                    $(".opinion").val($(".opinion").val() + $(".searched-result-list-item1.tagSelected").data('recommend'));
                    var $disease = $("<input/>").attr('type', 'hidden').addClass('diag_names').val($(".searched-result-list-item1.tagSelected").html());

                    $disease.appendTo($("#diag"));
                }
                $(".stock-count").html(Number($(".stock-count").html())+1);
                var price = 0;
                $.each($(".medi-price-cell"), function () {
                    price += Number($(this).html().replace("," , ""))

                 });
                 $(".stock-price").html(CommaFormatted(price));
                }
            });
            $(document).on('click','.submit',function(){
                
		if(confirm('처방할까요?')){

		var arr = [];
                $.each($(".diag_names"), function () {
                    arr.push($(this).val());
                });
                var name = arr.join(", ");
                $.ajax({
                    type: "POST",
                    url: "/insert_diagn",
                    dataType: 'json',
                    data: { DIAGN_NAME: name, DIAGN_OPINION: $(".diagnosis").val()+"\n"+$(".opinion").val(), DIAGN_PRICE:$(".stock-price").html().replace(",",""), HOSPITAL_ID: {{hospt_id}}, PET_ID: {{pet_id}} }, 
                    complete: function(data){
                        //window.location.reload(true);
			setTimeout(function(){// wait for 5 secs(2)
           			console.log("reload");
				location.reload(); // then reload the page.(3)
      			}, 3000); 
			//location.reload();
                    }
                });
		}
            });
        </script>
        <div class="header-container">
            <div class="header">
                <div class="rep-name">대표운영자(<font color="#5C74B7">rlqls505</font>)님</div>
                <div></div>
                <div class="logout">로그아웃</div>
                <div></div>
                <div class="header-menu">메뉴얼</div>
                <div class="header-menu">1:1문의</div>
                <div class="header-menu">고객센터</div>
            </div>

        </div>
        <div class="nav-container">
            <div class="nav">
                <div class="logo"><img src="{{url_for('static', filename='img/logo.png') }}"></div>
                <div class="nav-menu act" data-item="diag">
                    <div class="nav-menu-logo">
                        <img src="{{url_for('static', filename='img/man.png') }}">
                    </div>
                    <div class="nav-menu-text">기본진료</div>
                </div>
                <div class="nav-menu" data-item="more">
                    <div class="nav-menu-logo">
                        <img src="{{url_for('static', filename='img/more.png') }}">
                    </div>
                    <div class="nav-menu-text">정밀검사</div>
                </div>
                <div class="nav-menu" data-item="medicines">
                    <div class="nav-menu-logo">
                        <img src="{{url_for('static', filename='img/medicine.png') }}">
                    </div>
                    <div class="nav-menu-text">마약관리</div>
                </div>
                <div class="nav-menu" data-item="memo">
                    <div class="nav-menu-logo">
                        <img src="{{url_for('static', filename='img/memo.png') }}">
                    </div>
                    <div class="nav-menu-text">수가/메모</div>
                </div>
                <div class="nav-menu" data-item="person">
                    <div class="nav-menu-logo">
                        <img src="{{url_for('static', filename='img/man.png') }}">
                    </div>
                    <div class="nav-menu-text">보호자관리</div>
                </div>
                <div class="nav-menu" data-item="chat">
                    <div class="nav-menu-logo">
                        <img src="{{url_for('static', filename='img/chatt.png') }}">
                    </div>
                    <div class="nav-menu-text">채팅하기</div>
                </div>
                <div></div>
            </div>

        </div>
        <div class="body-container">
            <div class="body">
                <div class="vs-wrapper" id="diag">
				    <div class="vs-content">
                        <div class="content-diag">
                            <div class="table-big">
                                <div class="title">개인정보</div>
                                <div class="personal">
                                    <div class="name">이름</div>
                                    <div class="cell" id="pet_name"></div>
                                    <div class="name">보호자</div>
                                    <div class="cell" id="pet_person"></div>
                                    <div class="name">품종</div>
                                    <div class="cell" id="pet_spec"></div>
                                    <div class="name">입원여부</div>
                                    <div class="cell" id="pet_adms"></div>
                                    <div class="name">나이(Y)</div>
                                    <div class="cell" id="pet_age"></div>
                                    <div class="name">체중(kg)</div>
                                    <div class="cell" id="pet_weight"></div>
                                    <div class="name">성별</div>
                                    <div class="cell" id="pet_sex"></div>
                                    <div class="name"></div>
                                    <div class="cell"></div>
                                    <div class="name">연락처</div>
                                    <div class="cell" id="pet_contact"></div>
                                    <div class="name"></div>
                                    <div class="cell"></div>
                                    <div class="name cell-2">특이사항</div>
                                    <div class="cell cell-2" id="pet_profile"></div>
                                </div>

                            </div>
                            <div class="table-big">
                                <div class="title">이전진료</div>
                                <div class="prev">
                                    <div id="cell-prev" class="content-cell-prev">

                                    </div>
                                    <div id="cell-prev-c" class="content-cell-prev-c"></div>
                                </div>
                            </div>
                            <div class="table-big">
                                <div class="title">현재진료</div>
                                <textarea rows="4" style="resize:none;" class="diagnosis" placeholder="진료내용을 메모해주세요"></textarea>
                            </div>
                        </div>
                        <div class="content-search">
                            <div style="height:100%; display:inline-flex;align-items: center;"><hr width="100%" color="#EAEAEA"></div>
                            <div class="search">
                                <div class="search-button" data-item="0">질 &nbsp; 병</div>
                                <div class="search-button search-type" data-item="1">증 &nbsp; 상</div>
                                <div class="search-button" data-item="2">약 &nbsp; 품</div>
                                <div></div>
                                <form class="search-form"  onsubmit="return false;">
                                    <input type="text" id="diag_search" autocomplete="off"/>
                                    <div class="search-list">
                                    </div>

                                </form>
                                <div></div>
                            </div>
                            <div></div>
                        </div>
                        <div class="content-insert">
                            <div class="insert">
                                <div class="medicine-container">
                                    <div class="search-result">
                                        <div class="table">
                                            <div class="title">질병명</div>
                                            <div class="searched1" id="searched1"></div>
                                        </div>
                                        <div class="table">
                                            <div class="title">증상명</div>
                                            <div class="searched2" id="searched2"></div>
                                        </div>
                                    </div>
                                    <div class="medicine-result">
                                        <div class="table">
                                            <div class="title">약품명</div>
                                            <div class="medicine-category" id="medicine-category"></div>
                                        </div>
                                        <div class="table">
                                            <div class="title">약품상세info</div>
                                            <div class="medicine-category" id="medicine"></div>
                                        </div>
                                    </div>

                                </div>
                                <div class="stock-container">
                                    <div class="table">
                                        <div class="title">자가관리</div>
                                        <div class="self-result"></div>
                                    </div>
                                    <div class="stock">
                                        <div class="title1">처방관리</div>
                                        <div class="title2">수가입력</div>
                                        <div class="name">품명</div>
                                        <div class="name">kg양</div>
                                        <div class="name">일수</div>
                                        <div class="name">일투수</div>
                                        <div class="name">일투량</div>
                                        <div class="name">실수량</div>
                                        <div class="name">수량</div>
                                        <div class="name">단가</div>
                                        <div class="name">금액</div>
                                        <div class="cell-container"></div>
                                        <div class="title3">합 &nbsp; &nbsp; &nbsp;계</div>
                                        <div class="stock-count">0</div>
                                        <div class="stock-price">0</div>
                                    </div>
                                </div>
                                <div></div>
                            </div>
                            <div class="final">
                                <textarea rows="4" style="resize:none;" class="opinion" placeholder="종합소견을 입력해주세요"></textarea>
                                <div class="submits">
                                    <div class="check">검사하기</div>
                                    <div class="submit">처방하기</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="vs-wrapper" id="more">
				    <div class="vs-content">
                        <script>
                $.ajax({
                    url : '/load_personal',
                    success : function(data){
                        for(key in transform(data)){
                            $('#'+key.toLowerCase()+"2").html(data[key]);
                        }

                    },
                    fail : function(){
                        alert("asdfasdfasdf");
                    },
                    type : 'post',
                    dataType: 'json',
                    data : {pet_id : "{{pet_id}}"}
                });
            $(document).on('click','.predict-searched-result-list-item1',function(){
                if($(this).attr("data-select") == 1){
                    $(this).attr("data-select", 0);
                    $(this).removeClass('tagSelected');
                }
                else{
                    $(".predict-searched-result-list-item1.tagSelected").attr("data-select", 0);
                    $(".predict-searched-result-list-item1.tagSelected").removeClass('tagSelected');
                    $(this).attr("data-select", 1);
                    $(this).addClass('tagSelected');
                }
                $.ajax({
                    url : '/disease',
                    success : function(data){
                        $("#myResult").html(data.DISEASE_DIAG);

                    },
                    fail : function(){
                        alert("asdfasdfasdf");
                    },
                    type : 'post',
                    dataType: 'json',
                    data : {disease_id : $(".predict-searched-result-list-item1.tagSelected").attr("data-item")}
                });
            });

            var $moreData = $('<div/>').append($('<div/>')).append($('<div/>')).append($('<div/>')).append($('<div/>')).append($('<div/>')).append($('<div/>')).append($('<div/>'));

            var moreData = "<div>\
                               <div>혈액검사 bi.</div>\
                               <div>ALT_</div>\
                               <div>94</div>\
                               <div>12.12</div>\
                               <div>12.12</div>\
                               <div>U/L</div>\
                               <div>권기빈</div>\
                            </div>\
                            <div>\
                               <div></div>\
                               <div>ATS_</div>\
                               <div>25</div>\
                               <div>12.12</div>\
                               <div>12.12</div>\
                               <div>U/L</div>\
                               <div>권기빈</div>\
                            </div>\
                            <div>\
                               <div></div>\
                               <div>ALP_</div>\
                               <div>80</div>\
                               <div>12.12</div>\
                               <div>12.12</div>\
                               <div></div>\
                               <div></div>\
                            </div>\
                            <div>\
                               <div></div>\
                               <div>Total bilirubin_</div>\
                               <div>0.03</div>\
                               <div>12.12</div>\
                               <div>12.12</div>\
                               <div></div>\
                               <div></div>\
                            </div>\
                            <div>\
                               <div></div>\
                               <div>r-GT-</div>\
                               <div>8</div>\
                               <div>12.12</div>\
                               <div>12.12</div>\
                               <div></div>\
                               <div></div>\
                            </div>\
                            <div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                            </div>\
                            <div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                            </div>\
                            <div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                            </div>\
                            <div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                            </div>\
                            <div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                            </div>\
                            <div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                            </div>\
                            <div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                            </div>";
           var moreData2 = "<div>\
                               <div>초음파검사 bi.</div>\
                               <div>ALT_</div>\
                               <div>6</div>\
                               <div>18.12</div>\
                               <div>18.12</div>\
                               <div>U/L</div>\
                               <div>이경민</div>\
                            </div>\
                            <div>\
                               <div></div>\
                               <div>ATS_</div>\
                               <div>25</div>\
                               <div>18.118</div>\
                               <div>12.18</div>\
                               <div>U/L</div>\
                               <div></div>\
                            </div>\
                            <div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                            </div>\
                            <div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                            </div>\
                            <div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                            </div>\
                            <div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                            </div>\
                            <div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                            </div>\
                            <div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                            </div>\
                            <div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                            </div>\
                            <div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                            </div>\
                            <div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                            </div>\
                            <div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                               <div></div>\
                            </div>";
			$(document).on('click','.predict-result-cell',function(){
			    if($(this).data('item') == 0){
			        $(".more-results").empty();
                    $(".more-results").append(moreData);
			    }
			    else if($(this).data('item') == 1){
			        $(".more-results").empty();
                    $(".more-results").append(moreData2);
			    }

			});

                        </script>

                        <div class="content-more">
                            <div class="table-big">
                                <div class="title">개인정보</div>
                                <div class="personal">
                                    <div class="name">이름</div>
                                    <div class="cell" id="pet_name2"></div>
                                    <div class="name">보호자</div>
                                    <div class="cell" id="pet_person2"></div>
                                    <div class="name">품종</div>
                                    <div class="cell" id="pet_spec2"></div>
                                    <div class="name">입원여부</div>
                                    <div class="cell" id="pet_adms2"></div>
                                    <div class="name">나이(Y)</div>
                                    <div class="cell" id="pet_age2"></div>
                                    <div class="name">체중(kg)</div>
                                    <div class="cell" id="pet_weight2"></div>
                                    <div class="name">성별</div>
                                    <div class="cell" id="pet_sex2"></div>
                                    <div class="name"></div>
                                    <div class="cell"></div>
                                    <div class="name">연락처</div>
                                    <div class="cell" id="pet_contact2"></div>
                                    <div class="name"></div>
                                    <div class="cell"></div>
                                    <div class="name cell-2">특이사항</div>
                                    <div class="cell cell-2" id="pet_profile2"></div>
                                </div>

                            </div>
                            <div class="table-big">
                                <div class="title">의심질병</div>
                                <div id="predict_disease"></div>
                            </div>
                            <div class="table-big">
                                <div class="title">검사결과 및 소견</div>
                                <div id="myResult"></div>
                            </div>
                            <div class="table-big">
                                <div class="title">검사내역</div>
                                <div class="predict-result">
                                    <div class="predict-result-cell-title">
                                        <div>검사일자</div>
                                        <div>검사명</div>
                                        <div>환자명</div>
                                    </div>
                                    <div class="predict-result-cell" data-item="0">
                                        <div>2018-07-06 &nbsp;11:05</div>
                                        <div>혈액검사 bi.</div>
                                        <div>콜라</div>
                                    </div>
                                    <div class="predict-result-cell" data-item="1">
                                        <div>2018-08-19 &nbsp;12:04</div>
                                        <div>초음파검사 bi.</div>
                                        <div>콜라</div>
                                    </div>
                                    <div class="predict-result-cell"></div>
                                    <div class="predict-result-cell"></div>
                                    <div class="predict-result-cell"></div>
                                    <div class="predict-result-cell"></div>

                                </div>
                            </div>
                        </div>
                        <div class="content-search">

                        </div>
                        <div class="content-insert">
                            <div class="more-result">
                                <div>
                                    <div class="title">
                                        <div>검사명</div>
                                        <div>검사항목명</div>
                                        <div>결과</div>
                                        <div>Min.</div>
                                        <div>Max.</div>
                                        <div>단위</div>
                                        <div>입력자</div>
                                    </div>
                                    <div class="more-results">

                                    </div>
                                </div>
                            </div>
                            <div class="more-final">
                                <div>
                                    <div class="title">검사결과 메모</div>
                                    <textarea rows="4" style="resize:none;" class="opinion" placeholder="메모를 입력해주세요"></textarea>
                                </div>
                                <div class="submits">
                                    <div class="backDiag">진료화면 돌아가기</div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
                <div class="vs-wrapper" id="medicines">
				    <div class="vs-content">
                        <div class="content-container">
                            <div class="headers">
                                <div style="font-size:3vh; font-weight:normal; color:#7B7B7B;">
                                    <div class="nav-menu-logo">
                                        <img src="{{url_for('static', filename='img/man.png') }}">
                                    </div>
                                    보고내역
                                </div>
                                <div></div>
                                <div></div>
                                <div></div>
                                <div class="total">Total. 2</div>
                                <div></div>
                                <div></div>
                            </div>
                            <div class="content">
                                <div class="title">
                                    <div>no.</div>
                                    <div>보 호 자</div>
                                    <div>환자이름</div>
                                    <div>질병명</div>
                                    <div>취급일자</div>
                                    <div>보고생성일자</div>
                                    <div>담당자</div>
                                    <div>보고번호</div>
                                </div>
                                <div class="content-table">
                                    <div class="content-row">
                                        <div>1</div>
                                        <div>권기빈</div>
                                        <div>봄이</div>
                                        <div>쿠싱증후군</div>
                                        <div>2018-09-12</div>
                                        <div>2018-09-12 오후 3:00</div>
                                        <div>최진영</div>
                                        <div>MCM20180912_0000000018</div>
                                    </div>
                                    <div class="content-row">
                                        <div>2</div>
                                        <div>권기빈</div>
                                        <div>콜라</div>
                                        <div>ADHD</div>
                                        <div>2018-09-13</div>
                                        <div>2018-09-13 오후 1:15</div>
                                        <div>최진영</div>
                                        <div>MCM20180913_0000000310</div>
                                    </div>
                                </div>

                                <div class="content-last">
                                    <div></div>
                                    <div class="paging">
                                        <div class="arrow">&lt;</div>
                                        <div class="act num" data-item="1">1</div>
                                        <div class="num" data-item="2">2</div>
                                        <div class="num" data-item="3">3</div>
                                        <div class="num" data-item="4">4</div>
                                        <div class="num" data-item="5">5</div>
                                        <div class="arrow">&gt;</div>
                                    </div>


                                </div>

                            </div>

                        </div>
                    </div>
				    <div class="vs-content">
                        <div class="content-container">
                            <div class="headers">
                                <div style="font-size:3vh; font-weight:normal; color:#7B7B7B;">
                                    <div class="nav-menu-logo">
                                        <img src="{{url_for('static', filename='img/man.png') }}">
                                    </div>
                                    취급 마약류
                                </div>
                                <div></div>
                                <div></div>
                                <div></div>
                                <div class="total">Total. 1</div>
                                <div></div>
                                <div></div>
                            </div>
                            <div class="content">
                                <div class="title-2">
                                    <div>no.</div>
                                    <div>제품명</div>
                                    <div>일수</div>
                                    <div>일투수</div>
                                    <div>일투량</div>
                                    <div>낱개단위</div>
                                    <div>낱개수량</div>
                                    <div>폐기량</div>
                                    <div>포장단위</div>
                                    <div>제조번호</div>
                                    <div>유통기한</div>
                                    <div>제품코드</div>
                                    <div>저장소 번호</div>
                                    <div>제조일련번호</div>
                                </div>
                                <div class="content-table">
                                    <div class="content-row2">
                                        <div>1</div>
                                        <div style="font-size:1.2vh;">하나페노바르비탈 정 30mg(Phenob..</div>
                                        <div>1</div>
                                        <div>3</div>
                                        <div>1.2906</div>
                                        <div>정</div>
                                        <div>3.62725</div>
                                        <div>0.37281</div>
                                        <div>병</div>
                                        <div>0000244243</div>
                                        <div>2018-09-12</div>
                                        <div>880657800</div>
                                        <div>S0002</div>
                                        <div>B000008085</div>
                                    </div>

                                </div>

                                <div class="content-last">
                                    <div></div>
                                    <div class="paging">
                                        <div class="arrow">&lt;</div>
                                        <div class="act num" data-item="1">1</div>
                                        <div class="num" data-item="2">2</div>
                                        <div class="num" data-item="3">3</div>
                                        <div class="num" data-item="4">4</div>
                                        <div class="num" data-item="5">5</div>
                                        <div class="arrow">&gt;</div>
                                    </div>


                                </div>

                            </div>

                        </div>
                    </div>
                </div>
                <div class="vs-wrapper" id="memo">

                     <script>
                            var page_id;
                            function allStock(jsons){
                                $.ajax({
                                    url : '/search_stock',
                                    success : function(data){
                                        let count = 0;
                                        console.log(data);
                                        $('#memo .content-table').empty();
                                        for(key in data){
                                            let type = "메모";
                                            if(data[key]['STOCK_TYPE'] == 0)
                                                type="수가";
                                            else
                                                type="메모";
                                            var row = '<div class="content-row"><div>'+(count+1)+'</div><div>'+type+'</div><div>'+data[key]['STOCK_NAME']+'</div><div>'+data[key]['STOCK_PRICE']+'</div><div>'+data[key]['STOCK_TIME']+'</div><div data-title="'+data[key]['STOCK_NAME']+'" data-item="'+data[key]['STOCK_ID']+'" class="item-edit" style="display:none;display:grid;grid-column-gap: 5px;grid-template-columns: 1fr 1fr;"><div class="item-edit-btn">edit</div><div class="item-del">del</div></div></div>';
                                            $('#memo .content-table').append(row);
                                            console.log(data[key]);
                                            count++;
                                        }
                                        $( "#memo .content-row, #memo .title" ).removeClass('edit');
                                        $("#memo-edit").data("item", 0);
                                        $("#memo-edit").html("편집");
                                        $(".item-edit").hide();
                                        $('#memo .total').html("Total. "+count);
                                        for(let x = 0;x<12-count;x++){
                                            var row = '<div class="content-row"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div>';
                                            $('#memo .content-table').append(row);
                                        }

                                    },
                                    fail : function(){
                                        alert("asdfasdfasdf");
                                    },
                                    type : 'post',
                                    dataType: 'json',
                                    data : jsons
                                });
                            }

                             $(document).on('click','#memo .num',function(){
                                $( "#memo .act" ).removeClass('act');
                                $(this).addClass('act');
                                $('.content-table').empty();
                                $('#memo .content-table').empty();
                                allStock({search : "", type : $('#memo-type').val(), num : $('#memo .act').data('item')});
                            });
                            $(document).ready(function() {
                                allStock({search : "", type : $('#memo-type').val(), num : 0});
                            });
                            $(document).on('change','#memo-type',function () {
                                allStock({search : "", type : $('#memo-type').val(), num : 0});
                            });
                            $(document).on('keyup', "#memo-search", function(e) {
                                if(e.keyCode == 13){
                                    allStock({search : $(this).val(), type : $('#memo-type').val(), num : 0});
                                }
                            });
                            $(document).on('click', '#memo-add, .item-edit-btn', function(){
                                var memoWindow;
                                if($(this).hasClass("item-edit-btn")){
                                    memoWindow = window.open("/memo?id="+$(this).closest("div.item-edit").data("item"), "popupWindow", "width=1000,height=630,scrollbars=no");
                                }
                                else{
                                    memoWindow = window.open("/memo?id=0", "popupWindow", "width=1000,height=630,scrollbars=no");
                                }

                                if (typeof memoWindow.attachEvent != "undefined") {
                                    memoWindow.attachEvent("onunload", function(){allStock({search : $("#memo-search").val(), type : $('#memo-type').val(), num : 0});});
                                } else if (typeof memoWindow.addEventListener != "undefined") {
                                    memoWindow.addEventListener("unload", function(){allStock({search : $("#memo-search").val(), type : $('#memo-type').val(), num : 0});}, false);
                                }


                            });
                            $(document).on('click','#memo-edit',function(){
                                if($(this).data("item") == 0){
                                    $( "#memo .content-row, #memo .title" ).addClass('edit');
                                    $(this).data("item", 1);
                                    $(this).html("완료");
                                    $(".item-edit").show();
                                }
                                else{
                                    $( "#memo .content-row, #memo .title" ).removeClass('edit');
                                    $(this).data("item", 0);
                                    $(this).html("편집");
                                    $(".item-edit").hide();
                                }
                            });
                            $(document).on('click', '.item-del', function(){
                                if(confirm("'" + $(this).closest("div.item-edit").data("title")+ "' 를 삭제하시겠습니까?")){
                                var iid = $(this).closest("div.item-edit").data("item");
                                $.ajax({
                                    url : '/delete_stock',
                                    success : function(data){

                                        allStock({search : $("#memo-search").val(), type : $('#memo-type').val(), num : 0});
                                    },
                                    fail : function(){
                                        alert("asdfasdfasdf");
                                    },
                                    type : 'post',
                                    dataType: 'text',
                                    data : {id : iid}
                                });


                                }
                            });
                    </script>


				    <div class="vs-content">
                        <div class="content-container">
                            <div class="headers">
                                <div style="font-size:3vh; font-weight:normal; color:#7B7B7B;">
                                    <div class="nav-menu-logo">
                                        <img src="{{url_for('static', filename='img/man.png') }}">
                                    </div>
                                    수가/메모관리
                                </div>
                                <select style="height:3.7vh;" id="memo-type">
                                  <option value="0">전체</option>
                                  <option value="1">메모</option>
                                  <option value="2">수가</option>
                                </select>
                                <input type="text" style="height:3.3vh;" placeholder="검색어와 엔터를 입력해주세요" id="memo-search">
                                <div></div>
                                <div class="total">Total. 0</div>
                                <div></div>
                                <div style="height:3.3vh;display:grid;grid-column-gap: 5px;grid-template-columns: 1fr 1fr 1fr;color: #FFFFFF;font-size:1.64vh;font-weight:200;">
                                    <div id="memo-add" style="background:#203B84;display:inline-flex;align-items: center;justify-content: center;">추가</div>
                                    <div data-item="0" id="memo-edit" style="background:#7B7B7B;display:inline-flex;align-items: center;justify-content: center;">편집</div>

                                </div>
                            </div>
                            <div class="content">
                                <div class="title">
                                    <div>no.</div>
                                    <div>구 &nbsp; 분</div>
                                    <div>제 &nbsp; 목</div>
                                    <div>내 &nbsp; 용</div>
                                    <div>저장 일자</div>
                                </div>
                                <div class="content-table">


                                </div>

                                <div class="content-last">
                                    <div></div>
                                    <div class="paging">
                                        <div class="arrow">&lt;</div>
                                        <div class="act num" data-item="1">1</div>
                                        <div class="num" data-item="2">2</div>
                                        <div class="num" data-item="3">3</div>
                                        <div class="num" data-item="4">4</div>
                                        <div class="num" data-item="5">5</div>
                                        <div class="arrow">&gt;</div>
                                    </div>


                                </div>

                            </div>

                        </div>




                    </div>
                </div>
                <div class="vs-wrapper" id="person">
                        <script>
                            var page_id;
                            function allPerson(jsons){
                                $.ajax({
                                    url : '/allPerson',
                                    success : function(data){
                                        let count = 0;
                                        for(key in data){
                                            var sex = '?';
                                            switch(data[key]['PET_SEX']){
                                              case '0': sex = 'F'; break;
                                              case '1': sex = 'M'; break;
                                              case '2': sex = 'CF'; break;
                                              case '3': sex = 'CM'; break;
                                              default: sex = '?'; break;
                                            }
                                            var row = '<div class="content-row"><div>'+(count+1)+'</div><div>'+data[key]['PET_PERSON']+'</div><div>'+data[key]['PET_NAME']+'</div><div>'+data[key]['PET_SPEC']+'</div><div>'+sex+'</div><div>'+data[key]['PET_AGE']+'</div><div>'+data[key]['DIAGN_NAME']+'</div><div>'+data[key]['DIAGN_DATE'].split(' ')[0]+'</div></div>';
                                            $('#person .content-table').append(row);
                                            console.log(data[key]);
                                            count++;
                                        }
                                        $('#person .total').html("Total. "+count);
                                        for(let x = 0;x<12-count;x++){
                                            var row = '<div class="content-row"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div>';
                                            $('#person .content-table').append(row);
                                        }

                                    },
                                    fail : function(){
                                        alert("asdfasdfasdf");
                                    },
                                    type : 'post',
                                    dataType: 'json',
                                    data : jsons
                                });
                            }
                            $(document).on('click','#person .num',function(){
                                $( "#person .act" ).removeClass('act');
                                $(this).addClass('act');
                                $('.content-table').empty();

                                allPerson({hospt_id : "{{hospt_id}}", page : $('#person .act').data('item')});
                            });
                            $(document).ready(function() {
                                $('#person .content-table').empty();

                                allPerson({hospt_id : "{{hospt_id}}", page : $('#person .act').data('item'), num : 'all'});

                            });

                    </script>


				    <div class="vs-content">
                        <div class="content-container">
                            <div class="headers">
                                <div style="font-size:3vh; font-weight:normal; color:#7B7B7B;">
                                    <div class="nav-menu-logo">
                                        <img src="{{url_for('static', filename='img/man.png') }}">
                                    </div>
                                    보호자관리
                                </div>
                                <select style="height:3.7vh;">
                                  <option value="recent">최근 방문순</option>
                                </select>
                                <input type="text" style="height:3.3vh;" placeholder="검색어를 입력해주세요">
                                <div></div>
                                <div class="total">Total. 0</div>
                                <div></div>
                                <div></div>
                            </div>
                            <div class="content">
                                <div class="title">
                                    <div>no.</div>
                                    <div>보 호 자</div>
                                    <div>환자 이름</div>
                                    <div>품 &nbsp; 종</div>
                                    <div>성 &nbsp; 별</div>
                                    <div>나 &nbsp; 이 (Y)</div>
                                    <div>질병 기록</div>
                                    <div>최근 방문일자</div>
                                </div>
                                <div class="content-table">


                                </div>

                                <div class="content-last">
                                    <div></div>
                                    <div class="paging">
                                        <div class="arrow">&lt;</div>
                                        <div class="act num" data-item="1">1</div>
                                        <div class="num" data-item="2">2</div>
                                        <div class="num" data-item="3">3</div>
                                        <div class="num" data-item="4">4</div>
                                        <div class="num" data-item="5">5</div>
                                        <div class="arrow">&gt;</div>
                                    </div>


                                </div>

                            </div>

                        </div>




                    </div>
                </div>

            </div>
        </div>
        <div>

        </div>
        <div class="modal"><!-- Place at bottom of page --></div>
    </body>
</html>
